import{r as t,h as e,H as s}from"./p-13539f84.js";
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.2.0
 */const r="calcite-mode-auto";const n="calcite-mode-dark";
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.2.0
 */function i(){const{classList:t}=document.body;const e=window.matchMedia("(prefers-color-scheme: dark)").matches;const s=()=>t.contains(n)||t.contains(r)&&e?"dark":"light";const i=t=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:true,detail:{mode:t}}));const o=t=>{a!==t&&i(t);a=t};let a=s();i(a);window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(t=>o(t.matches?"dark":"light")));new MutationObserver((()=>o(s()))).observe(document.body,{attributes:true,attributeFilter:["class"]})}function o(){const t=typeof window!=="undefined"&&typeof location!=="undefined"&&typeof document!=="undefined"&&window.location===location&&window.document===document;if(t){if(document.readyState==="interactive"){i()}else{document.addEventListener("DOMContentLoaded",(()=>i()),{once:true})}}}const a=o;a();function c(t){return Object.keys(t).some((e=>{let s=t[e];if(!s){return false}if(s&&s.toParam){s=s.toParam()}const r=s.constructor.name;switch(r){case"Array":return false;case"Object":return false;case"Date":return false;case"Function":return false;case"Boolean":return false;case"String":return false;case"Number":return false;default:return true}}))}function u(t){const e={};Object.keys(t).forEach((s=>{var r,n;let i=t[s];if(i&&i.toParam){i=i.toParam()}if(!i&&i!==0&&typeof i!=="boolean"&&typeof i!=="string"){return}const o=i.constructor.name;let a;switch(o){case"Array":const t=(n=(r=i[0])===null||r===void 0?void 0:r.constructor)===null||n===void 0?void 0:n.name;a=t==="Array"?i:t==="Object"?JSON.stringify(i):i.join(",");break;case"Object":a=JSON.stringify(i);break;case"Date":a=i.valueOf();break;case"Function":a=null;break;case"Boolean":a=i+"";break;default:a=i;break}if(a||a===0||typeof a==="string"||Array.isArray(a)){e[s]=a}}));return e}function l(t,e){if(Array.isArray(e)&&e[0]&&Array.isArray(e[0])){return e.map((e=>l(t,e))).join("&")}return encodeURIComponent(t)+"="+encodeURIComponent(e)}function h(t){const e=u(t);return Object.keys(e).map((t=>l(t,e[t]))).join("&")}var f={FormData:globalThis.FormData,File:globalThis.File,Blob:globalThis.Blob};function d(t,e){const s=c(t)||e;const r=u(t);if(s){const t=new f.FormData;Object.keys(r).forEach((e=>{if(typeof Blob!=="undefined"&&r[e]instanceof Blob){const s=r["fileName"]||r[e].name||e;t.append(e,r[e],s)}else{t.append(e,r[e])}}));return t}else{return h(t)}}class p extends Error{constructor(t,e,s,r,n){super(t);const i=new.target.prototype;Object.setPrototypeOf(this,i);t=t||"UNKNOWN_ERROR";e=e||"UNKNOWN_ERROR_CODE";this.name="ArcGISRequestError";this.message=e==="UNKNOWN_ERROR_CODE"?t:`${e}: ${t}`;this.originalMessage=t;this.code=e;this.response=s;this.url=r;this.options=n}}function m(t){if(console&&console.warn){console.warn.apply(console,[t])}}var w=function t(){return Promise.resolve({fetch:globalThis.fetch,Headers:globalThis.Headers,Response:globalThis.Response,Request:globalThis.request})};const b=`@esri/arcgis-rest-js`;function g(){return globalThis.DEFAULT_ARCGIS_REQUEST_OPTIONS||{httpMethod:"POST",params:{f:"json"}}}class O extends p{constructor(t="AUTHENTICATION_ERROR",e="AUTHENTICATION_ERROR_CODE",s,r,n){super(t,e,s,r,n);this.name="ArcGISAuthError";this.message=e==="AUTHENTICATION_ERROR_CODE"?t:`${e}: ${t}`;const i=new.target.prototype;Object.setPrototypeOf(this,i)}retry(t,e=1){let s=0;const r=(n,i)=>{s=s+1;t(this.url,this.options).then((t=>{const e=Object.assign(Object.assign({},this.options),{authentication:t});return T(this.url,e)})).then((t=>{n(t)})).catch((t=>{if(t.name==="ArcGISAuthError"&&s<e){r(n,i)}else if(t.name===this.name&&t.message===this.message&&s>=e){i(this)}else{i(t)}}))};return new Promise(((t,e)=>{r(t,e)}))}}function y(t,e,s,r,n){if(t.code>=400){const{message:s,code:n}=t;throw new p(s,n,t,e,r)}if(t.error){const{message:s,code:i,messageCode:o}=t.error;const a=o||i||"UNKNOWN_ERROR_CODE";if(i===498||i===499){if(n){throw n}else{throw new O(s,a,t,e,r)}}throw new p(s,a,t,e,r)}if(t.status==="failed"||t.status==="failure"){let s;let n="UNKNOWN_ERROR_CODE";try{s=JSON.parse(t.statusMessage).message;n=JSON.parse(t.statusMessage).code}catch(e){s=t.statusMessage||t.message}throw new p(s,n,t,e,r)}return t}function T(t,e){const s=g();const r=Object.assign(Object.assign(Object.assign({httpMethod:"POST"},s),e),{params:Object.assign(Object.assign({},s.params),e.params),headers:Object.assign(Object.assign({},s.headers),e.headers)});const{httpMethod:n,rawResponse:i}=r;const o=Object.assign({f:"json"},r.params);let a=null;const u={method:n,signal:r.signal,credentials:r.credentials||"same-origin"};if(r.headers&&r.headers["X-Esri-Auth-Client-Id"]&&t.indexOf("/oauth2/platformSelf")>-1){u.credentials="include"}let l;if(typeof r.authentication==="string"){const t=r.authentication;l={portal:"https://www.arcgis.com/sharing/rest",getToken:()=>Promise.resolve(t)};if(!r.authentication.startsWith("AAPK")&&!r.suppressWarnings&&!globalThis.ARCGIS_REST_JS_SUPPRESS_TOKEN_WARNING){m(`Using an oAuth 2.0 access token directly in the token option is discouraged. Consider using ArcGISIdentityManager or Application session. See https://esriurl.com/arcgis-rest-js-direct-token-warning for more information.`);globalThis.ARCGIS_REST_JS_SUPPRESS_TOKEN_WARNING=true}}else{l=r.authentication}const f=t;return(l?l.getToken(t).catch((e=>{e.url=t;e.options=r;a=e;return Promise.resolve("")})):Promise.resolve("")).then((e=>{if(e.length){o.token=e}if(l&&l.getDomainCredentials){u.credentials=l.getDomainCredentials(t)}const s={};if(u.method==="GET"){if(o.token&&r.hideToken&&typeof window==="undefined"){s["X-Esri-Authorization"]=`Bearer ${o.token}`;delete o.token}const n=h(o);const i=n===""?t:t+"?"+h(o);if(r.maxUrlLength&&i.length>r.maxUrlLength||o.token&&r.hideToken){u.method="POST";if(e.length&&r.hideToken){o.token=e;delete s["X-Esri-Authorization"]}}else{t=i}}const n=new RegExp("/items/.+/updateResources").test(t);if(u.method==="POST"){u.body=d(o,n)}u.headers=Object.assign(Object.assign({},s),r.headers);if((typeof window==="undefined"||window&&typeof window.document==="undefined")&&!u.headers.referer){u.headers.referer=b}if(!c(o)&&!n){u.headers["Content-Type"]="application/x-www-form-urlencoded"}return globalThis.fetch?globalThis.fetch(t,u):w().then((({fetch:e})=>e(t,u)))})).then((e=>{if(!e.ok){return e.json().then((s=>{const{status:n,statusText:i}=e;const{message:o,details:a}=s.error;const c=`${o}. ${a?a.join(" "):""}`.trim();throw new p(c,`HTTP ${n} ${i}`,s,t,r)})).catch((s=>{if(s.name==="ArcGISRequestError"){throw s}const{status:n,statusText:i}=e;throw new p(i,`HTTP ${n}`,e,t,r)}))}if(i){return e}switch(o.f){case"json":return e.json();case"geojson":return e.json();case"html":return e.text();case"text":return e.text();default:return e.blob()}})).then((e=>{if((o.f==="json"||o.f==="geojson")&&!i){const s=y(e,f,o,r,a);if(a){const e=t.toLowerCase().split(/\/rest(\/admin)?\/services\//)[0];r.authentication.federatedServers[e]={token:[],expires:new Date(Date.now()+86400*1e3)};a=null}return s}else{return e}}))}function R(t,e={params:{f:"json"}}){return T(t,e).catch((t=>{if(t instanceof O&&e.authentication&&typeof e.authentication!=="string"&&e.authentication.canRefresh&&e.authentication.refreshCredentials){return t.retry((()=>e.authentication.refreshCredentials()),1)}else{return Promise.reject(t)}}))}function j(t,e,s){const r=["params","httpMethod","rawResponse","authentication","portal","fetch","maxUrlLength","headers"];const n=Object.assign(Object.assign({params:{}},s),t);n.params=e.reduce(((e,s)=>{if(t[s]||typeof t[s]==="boolean"||typeof t[s]==="number"&&t[s]===0){e[s]=t[s]}return e}),n.params);return r.reduce(((t,e)=>{if(n[e]){t[e]=n[e]}return t}),{})}function N(t){if(typeof t!=="string"){return t}t=t.trim();if(t[t.length-1]==="/"){t=t.slice(0,-1)}return t}function k(t={}){if(t.portal){return N(t.portal)}if(t.authentication&&typeof t.authentication!=="string"){return t.authentication.portal}return"https://www.arcgis.com/sharing/rest"}class A{constructor(t=""){this.termStack=[];this.rangeStack=[];this.openGroups=0;this.q=t}match(...t){this.termStack=this.termStack.concat(t);return this}in(t){const e=`\`in(${t?`"${t}"`:""})\``;if(!this.hasRange&&!this.hasTerms){m(`${e} was called with no call to \`match(...)\` or \`from(...)\`/\`to(...)\`. Your query was not modified.`);return this}if(t&&t!=="*"){this.q+=`${t}:`}return this.commit()}startGroup(){this.commit();if(this.openGroups>0){this.q+=" "}this.openGroups++;this.q+="(";return this}endGroup(){if(this.openGroups<=0){m(`\`endGroup(...)\` was called without calling \`startGroup(...)\` first. Your query was not modified.`);return this}this.commit();this.openGroups--;this.q+=")";return this}and(){return this.addModifier("and")}or(){return this.addModifier("or")}not(){return this.addModifier("not")}from(t){if(this.hasTerms){m(`\`from(...)\` is not allowed after \`match(...)\` try using \`.from(...).to(...).in(...)\`. Optionally, you may see this because dates are incorrectly formatted. Dates should be a primative Date value, aka a number in milliseconds or Date object, ie new Date("2020-01-01").  Your query was not modified.`);return this}this.rangeStack[0]=t;return this}to(t){if(this.hasTerms){m(`\`to(...)\` is not allowed after \`match(...)\` try using \`.from(...).to(...).in(...)\`. Optionally, you may see this because dates are incorrectly formatted. Dates should be a primative Date value, aka a number in milliseconds or Date object, ie new Date("2020-01-01"). Your query was not modified.`);return this}this.rangeStack[1]=t;return this}boost(t){this.commit();this.q+=`^${t}`;return this}toParam(){this.commit();this.cleanup();return this.q}clone(){this.commit();this.cleanup();return new A(this.q+"")}addModifier(t){if(this.currentModifer){m(`You have called \`${this.currentModifer}()\` after \`${t}()\`. Your current query was not modified.`);return this}this.commit();if(this.q===""&&t!=="not"){m(`You have called \`${t}()\` without calling another method to modify your query first. Try calling \`match()\` first.`);return this}this.currentModifer=t;this.q+=this.q===""?"":" ";this.q+=`${t.toUpperCase()} `;return this}hasWhiteSpace(t){return/\s/g.test(t)}formatTerm(t){if(t instanceof Date){return t.getTime()}if(typeof t==="string"&&this.hasWhiteSpace(t)){return`"${t}"`}return t}commit(){this.currentModifer=undefined;if(this.hasRange){this.q+=`[${this.formatTerm(this.rangeStack[0])} TO ${this.formatTerm(this.rangeStack[1])}]`;this.rangeStack=[undefined,undefined]}if(this.hasTerms){this.q+=this.termStack.map((t=>this.formatTerm(t))).join(" ");this.termStack=[]}return this}get hasTerms(){return this.termStack.length>0}get hasRange(){return this.rangeStack.length&&this.rangeStack[0]&&this.rangeStack[1]}cleanup(){if(this.openGroups>0){m(`Automatically closing ${this.openGroups} group(s). You can use \`endGroup(...)\` to remove this warning.`);while(this.openGroups>0){this.q+=")";this.openGroups--}}const t=this.q;this.q=t.replace(/( AND ?| NOT ?| OR ?)*$/,"");if(t!==this.q){m(`\`startGroup(...)\` was called without calling \`endGroup(...)\` first. Your query was not modified.`)}this.q=this.q.replace(/(\(\))*/,"")}}function E(t,e){let s;if(typeof t==="string"||t instanceof A){s={httpMethod:"GET",params:{q:t}}}else{s=j(t,["q","num","start","sortField","sortOrder","searchUserAccess","searchUserName","filter","countFields","countSize","categories","categoryFilters"],{httpMethod:"GET"})}let r;switch(e){case"item":r="/search";break;case"group":r="/community/groups";break;case"groupContent":if(typeof t!=="string"&&!(t instanceof A)&&t.groupId){r=`/content/groups/${t.groupId}/search`}else{return Promise.reject(new Error("you must pass a `groupId` option to `searchGroupContent`"))}break;default:r="/portals/self/users/search";break}const n=k(s)+r;return R(n,s).then((s=>{if(s.nextStart&&s.nextStart!==-1){s.nextPage=function(){let r;if(typeof t==="string"||t instanceof A){r={q:t,start:s.nextStart}}else{r=t;r.start=s.nextStart}return E(r,e)}}return s}))}function D(t){return E(t,"item")}const $=":host{display:block}";const v=class{constructor(e){t(this,e);this.newAppSelected=false;this.newAppTimestamp=null;this.content=null}render(){return e(s,null,e("slot",null),e("calcite-modal",{id:"modal",scale:"m",width:"m",ref:t=>this.modal=t},e("div",{slot:"content"},this.newAppTimestamp?null:this.renderNewOptions(),this.content?this.renderContent():null)),this.renderNewButton())}openModal(){this.modal.open=true}componentWillLoad(){setInterval((()=>{this.checkForContent()}),1e3)}async checkForContent(){if(!this.newAppTimestamp){return}const t=this.newAppTimestamp;const e=new Date("2030-09-01");console.log("timestamp",{startDate:t,endDate:e});const s=(new A).from(t).to(e).in("created").and().match("StoryMap").in("type").and().match("aturner").in("owner");let r=[];await D(s).then((t=>{r=t.results}));if(r.length>0){this.content=r[0]}}renderContent(){return e("calcite-card",null,e("span",{slot:"title"},this.content.title),e("span",{slot:"subtitle"},this.content.snippet),e("calcite-chip",{slot:"footer-start",value:this.content.type,appearance:"outline-fill",kind:"neutral",icon:"add-in"},this.content.type),e("calcite-button",{slot:"footer-end",href:`https://storymaps.arcgis.com/stories/${this.content.id}`,target:"_new"},"Open"))}renderNewButton(){return e("calcite-button",{appearance:"solid",color:"blue",scale:"s",onClick:()=>this.openModal()},"New App")}newAppOpen(t){this.newAppTimestamp=new Date;this.newAppSelected=true;switch(t){case"storymap":window.open("https://storymaps.arcgis.com/stories/new","_blank");break}}renderNewOptions(){return e("div",{slot:"modal",class:"new-options"},e("calcite-button",{appearance:"solid",color:"blue",onClick:()=>this.newAppOpen("storymap")},"New StoryMap"))}};v.style=$;export{v as hub_new_app};
//# sourceMappingURL=p-b38bb552.entry.js.map