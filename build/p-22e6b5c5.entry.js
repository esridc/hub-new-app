import{r as t,h as e,H as s}from"./p-13539f84.js";
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.2.0
 */const i="calcite-mode-auto";const n="calcite-mode-dark";
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.2.0
 */function r(){const{classList:t}=document.body;const e=window.matchMedia("(prefers-color-scheme: dark)").matches;const s=()=>t.contains(n)||t.contains(i)&&e?"dark":"light";const r=t=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:true,detail:{mode:t}}));const o=t=>{a!==t&&r(t);a=t};let a=s();r(a);window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(t=>o(t.matches?"dark":"light")));new MutationObserver((()=>o(s()))).observe(document.body,{attributes:true,attributeFilter:["class"]})}function o(){const t=typeof window!=="undefined"&&typeof location!=="undefined"&&typeof document!=="undefined"&&window.location===location&&window.document===document;if(t){if(document.readyState==="interactive"){r()}else{document.addEventListener("DOMContentLoaded",(()=>r()),{once:true})}}}const a=o;a();function c(t){return Object.keys(t).some((e=>{let s=t[e];if(!s){return false}if(s&&s.toParam){s=s.toParam()}const i=s.constructor.name;switch(i){case"Array":return false;case"Object":return false;case"Date":return false;case"Function":return false;case"Boolean":return false;case"String":return false;case"Number":return false;default:return true}}))}function l(t){const e={};Object.keys(t).forEach((s=>{var i,n;let r=t[s];if(r&&r.toParam){r=r.toParam()}if(!r&&r!==0&&typeof r!=="boolean"&&typeof r!=="string"){return}const o=r.constructor.name;let a;switch(o){case"Array":const t=(n=(i=r[0])===null||i===void 0?void 0:i.constructor)===null||n===void 0?void 0:n.name;a=t==="Array"?r:t==="Object"?JSON.stringify(r):r.join(",");break;case"Object":a=JSON.stringify(r);break;case"Date":a=r.valueOf();break;case"Function":a=null;break;case"Boolean":a=r+"";break;default:a=r;break}if(a||a===0||typeof a==="string"||Array.isArray(a)){e[s]=a}}));return e}function h(t,e){if(Array.isArray(e)&&e[0]&&Array.isArray(e[0])){return e.map((e=>h(t,e))).join("&")}return encodeURIComponent(t)+"="+encodeURIComponent(e)}function u(t){const e=l(t);return Object.keys(e).map((t=>h(t,e[t]))).join("&")}var d={FormData:globalThis.FormData,File:globalThis.File,Blob:globalThis.Blob};function p(t,e){const s=c(t)||e;const i=l(t);if(s){const t=new d.FormData;Object.keys(i).forEach((e=>{if(typeof Blob!=="undefined"&&i[e]instanceof Blob){const s=i["fileName"]||i[e].name||e;t.append(e,i[e],s)}else{t.append(e,i[e])}}));return t}else{return u(t)}}class f extends Error{constructor(t,e,s,i,n){super(t);const r=new.target.prototype;Object.setPrototypeOf(this,r);t=t||"UNKNOWN_ERROR";e=e||"UNKNOWN_ERROR_CODE";this.name="ArcGISRequestError";this.message=e==="UNKNOWN_ERROR_CODE"?t:`${e}: ${t}`;this.originalMessage=t;this.code=e;this.response=s;this.url=i;this.options=n}}function m(t){if(console&&console.warn){console.warn.apply(console,[t])}}var w=function t(){return Promise.resolve({fetch:globalThis.fetch,Headers:globalThis.Headers,Response:globalThis.Response,Request:globalThis.request})};const b=`@esri/arcgis-rest-js`;function g(){return globalThis.DEFAULT_ARCGIS_REQUEST_OPTIONS||{httpMethod:"POST",params:{f:"json"}}}class y extends f{constructor(t="AUTHENTICATION_ERROR",e="AUTHENTICATION_ERROR_CODE",s,i,n){super(t,e,s,i,n);this.name="ArcGISAuthError";this.message=e==="AUTHENTICATION_ERROR_CODE"?t:`${e}: ${t}`;const r=new.target.prototype;Object.setPrototypeOf(this,r)}retry(t,e=1){let s=0;const i=(n,r)=>{s=s+1;t(this.url,this.options).then((t=>{const e=Object.assign(Object.assign({},this.options),{authentication:t});return A(this.url,e)})).then((t=>{n(t)})).catch((t=>{if(t.name==="ArcGISAuthError"&&s<e){i(n,r)}else if(t.name===this.name&&t.message===this.message&&s>=e){r(this)}else{r(t)}}))};return new Promise(((t,e)=>{i(t,e)}))}}function O(t,e,s,i,n){if(t.code>=400){const{message:s,code:n}=t;throw new f(s,n,t,e,i)}if(t.error){const{message:s,code:r,messageCode:o}=t.error;const a=o||r||"UNKNOWN_ERROR_CODE";if(r===498||r===499){if(n){throw n}else{throw new y(s,a,t,e,i)}}throw new f(s,a,t,e,i)}if(t.status==="failed"||t.status==="failure"){let s;let n="UNKNOWN_ERROR_CODE";try{s=JSON.parse(t.statusMessage).message;n=JSON.parse(t.statusMessage).code}catch(e){s=t.statusMessage||t.message}throw new f(s,n,t,e,i)}return t}function A(t,e){const s=g();const i=Object.assign(Object.assign(Object.assign({httpMethod:"POST"},s),e),{params:Object.assign(Object.assign({},s.params),e.params),headers:Object.assign(Object.assign({},s.headers),e.headers)});const{httpMethod:n,rawResponse:r}=i;const o=Object.assign({f:"json"},i.params);let a=null;const l={method:n,signal:i.signal,credentials:i.credentials||"same-origin"};if(i.headers&&i.headers["X-Esri-Auth-Client-Id"]&&t.indexOf("/oauth2/platformSelf")>-1){l.credentials="include"}let h;if(typeof i.authentication==="string"){const t=i.authentication;h={portal:"https://www.arcgis.com/sharing/rest",getToken:()=>Promise.resolve(t)};if(!i.authentication.startsWith("AAPK")&&!i.suppressWarnings&&!globalThis.ARCGIS_REST_JS_SUPPRESS_TOKEN_WARNING){m(`Using an oAuth 2.0 access token directly in the token option is discouraged. Consider using ArcGISIdentityManager or Application session. See https://esriurl.com/arcgis-rest-js-direct-token-warning for more information.`);globalThis.ARCGIS_REST_JS_SUPPRESS_TOKEN_WARNING=true}}else{h=i.authentication}const d=t;return(h?h.getToken(t).catch((e=>{e.url=t;e.options=i;a=e;return Promise.resolve("")})):Promise.resolve("")).then((e=>{if(e.length){o.token=e}if(h&&h.getDomainCredentials){l.credentials=h.getDomainCredentials(t)}const s={};if(l.method==="GET"){if(o.token&&i.hideToken&&typeof window==="undefined"){s["X-Esri-Authorization"]=`Bearer ${o.token}`;delete o.token}const n=u(o);const r=n===""?t:t+"?"+u(o);if(i.maxUrlLength&&r.length>i.maxUrlLength||o.token&&i.hideToken){l.method="POST";if(e.length&&i.hideToken){o.token=e;delete s["X-Esri-Authorization"]}}else{t=r}}const n=new RegExp("/items/.+/updateResources").test(t);if(l.method==="POST"){l.body=p(o,n)}l.headers=Object.assign(Object.assign({},s),i.headers);if((typeof window==="undefined"||window&&typeof window.document==="undefined")&&!l.headers.referer){l.headers.referer=b}if(!c(o)&&!n){l.headers["Content-Type"]="application/x-www-form-urlencoded"}return globalThis.fetch?globalThis.fetch(t,l):w().then((({fetch:e})=>e(t,l)))})).then((e=>{if(!e.ok){return e.json().then((s=>{const{status:n,statusText:r}=e;const{message:o,details:a}=s.error;const c=`${o}. ${a?a.join(" "):""}`.trim();throw new f(c,`HTTP ${n} ${r}`,s,t,i)})).catch((s=>{if(s.name==="ArcGISRequestError"){throw s}const{status:n,statusText:r}=e;throw new f(r,`HTTP ${n}`,e,t,i)}))}if(r){return e}switch(o.f){case"json":return e.json();case"geojson":return e.json();case"html":return e.text();case"text":return e.text();default:return e.blob()}})).then((e=>{if((o.f==="json"||o.f==="geojson")&&!r){const s=O(e,d,o,i,a);if(a){const e=t.toLowerCase().split(/\/rest(\/admin)?\/services\//)[0];i.authentication.federatedServers[e]={token:[],expires:new Date(Date.now()+86400*1e3)};a=null}return s}else{return e}}))}function v(t,e={params:{f:"json"}}){return A(t,e).catch((t=>{if(t instanceof y&&e.authentication&&typeof e.authentication!=="string"&&e.authentication.canRefresh&&e.authentication.refreshCredentials){return t.retry((()=>e.authentication.refreshCredentials()),1)}else{return Promise.reject(t)}}))}function k(t,e,s){const i=["params","httpMethod","rawResponse","authentication","portal","fetch","maxUrlLength","headers"];const n=Object.assign(Object.assign({params:{}},s),t);n.params=e.reduce(((e,s)=>{if(t[s]||typeof t[s]==="boolean"||typeof t[s]==="number"&&t[s]===0){e[s]=t[s]}return e}),n.params);return i.reduce(((t,e)=>{if(n[e]){t[e]=n[e]}return t}),{})}function T(t){if(typeof t!=="string"){return t}t=t.trim();if(t[t.length-1]==="/"){t=t.slice(0,-1)}return t}function j(t={}){if(t.portal){return T(t.portal)}if(t.authentication&&typeof t.authentication!=="string"){return t.authentication.portal}return"https://www.arcgis.com/sharing/rest"}class N{constructor(t=""){this.termStack=[];this.rangeStack=[];this.openGroups=0;this.q=t}match(...t){this.termStack=this.termStack.concat(t);return this}in(t){const e=`\`in(${t?`"${t}"`:""})\``;if(!this.hasRange&&!this.hasTerms){m(`${e} was called with no call to \`match(...)\` or \`from(...)\`/\`to(...)\`. Your query was not modified.`);return this}if(t&&t!=="*"){this.q+=`${t}:`}return this.commit()}startGroup(){this.commit();if(this.openGroups>0){this.q+=" "}this.openGroups++;this.q+="(";return this}endGroup(){if(this.openGroups<=0){m(`\`endGroup(...)\` was called without calling \`startGroup(...)\` first. Your query was not modified.`);return this}this.commit();this.openGroups--;this.q+=")";return this}and(){return this.addModifier("and")}or(){return this.addModifier("or")}not(){return this.addModifier("not")}from(t){if(this.hasTerms){m(`\`from(...)\` is not allowed after \`match(...)\` try using \`.from(...).to(...).in(...)\`. Optionally, you may see this because dates are incorrectly formatted. Dates should be a primative Date value, aka a number in milliseconds or Date object, ie new Date("2020-01-01").  Your query was not modified.`);return this}this.rangeStack[0]=t;return this}to(t){if(this.hasTerms){m(`\`to(...)\` is not allowed after \`match(...)\` try using \`.from(...).to(...).in(...)\`. Optionally, you may see this because dates are incorrectly formatted. Dates should be a primative Date value, aka a number in milliseconds or Date object, ie new Date("2020-01-01"). Your query was not modified.`);return this}this.rangeStack[1]=t;return this}boost(t){this.commit();this.q+=`^${t}`;return this}toParam(){this.commit();this.cleanup();return this.q}clone(){this.commit();this.cleanup();return new N(this.q+"")}addModifier(t){if(this.currentModifer){m(`You have called \`${this.currentModifer}()\` after \`${t}()\`. Your current query was not modified.`);return this}this.commit();if(this.q===""&&t!=="not"){m(`You have called \`${t}()\` without calling another method to modify your query first. Try calling \`match()\` first.`);return this}this.currentModifer=t;this.q+=this.q===""?"":" ";this.q+=`${t.toUpperCase()} `;return this}hasWhiteSpace(t){return/\s/g.test(t)}formatTerm(t){if(t instanceof Date){return t.getTime()}if(typeof t==="string"&&this.hasWhiteSpace(t)){return`"${t}"`}return t}commit(){this.currentModifer=undefined;if(this.hasRange){this.q+=`[${this.formatTerm(this.rangeStack[0])} TO ${this.formatTerm(this.rangeStack[1])}]`;this.rangeStack=[undefined,undefined]}if(this.hasTerms){this.q+=this.termStack.map((t=>this.formatTerm(t))).join(" ");this.termStack=[]}return this}get hasTerms(){return this.termStack.length>0}get hasRange(){return this.rangeStack.length&&this.rangeStack[0]&&this.rangeStack[1]}cleanup(){if(this.openGroups>0){m(`Automatically closing ${this.openGroups} group(s). You can use \`endGroup(...)\` to remove this warning.`);while(this.openGroups>0){this.q+=")";this.openGroups--}}const t=this.q;this.q=t.replace(/( AND ?| NOT ?| OR ?)*$/,"");if(t!==this.q){m(`\`startGroup(...)\` was called without calling \`endGroup(...)\` first. Your query was not modified.`)}this.q=this.q.replace(/(\(\))*/,"")}}function R(t,e){let s;if(typeof t==="string"||t instanceof N){s={httpMethod:"GET",params:{q:t}}}else{s=k(t,["q","num","start","sortField","sortOrder","searchUserAccess","searchUserName","filter","countFields","countSize","categories","categoryFilters"],{httpMethod:"GET"})}let i;switch(e){case"item":i="/search";break;case"group":i="/community/groups";break;case"groupContent":if(typeof t!=="string"&&!(t instanceof N)&&t.groupId){i=`/content/groups/${t.groupId}/search`}else{return Promise.reject(new Error("you must pass a `groupId` option to `searchGroupContent`"))}break;default:i="/portals/self/users/search";break}const n=j(s)+i;return v(n,s).then((s=>{if(s.nextStart&&s.nextStart!==-1){s.nextPage=function(){let i;if(typeof t==="string"||t instanceof N){i={q:t,start:s.nextStart}}else{i=t;i.start=s.nextStart}return R(i,e)}}return s}))}function C(t){return R(t,"item")}const E=":host{display:block}.new-options{display:flex;flex-direction:column;align-items:center;margin-top:20px;row-gap:20px}#content{height:50vh}.app{margin:10px}.app calcite-button{padding-left:5px}";const D=class{constructor(e){t(this,e);this.builders=[{name:"StoryMap",type:"StoryMap",key:"storymap",new:"https://storymaps.arcgis.com/stories/new",view:"https://storymaps.arcgis.com/stories/"},{name:"Dashboard",type:"Dashboard",key:"dashboard",new:"https://dcdev.maps.arcgis.com/apps/dashboards/new",view:"https://storymaps.arcgis.com/stories/"},{name:"Instant App",type:"Web Mapping Application",key:"instant",new:"https://dcdev.maps.arcgis.com/apps/instantgallery/index.html?tab=browseAll",view:"https://storymaps.arcgis.com/stories/"}];this.defaultBuilder={name:"ArcGIS Online",type:"None",key:"ago",new:"https://dcdev.maps.arcgis.com/home/",view:"https://dcdev.maps.arcgis.com/home/items.html?id="};this.username="aturner";this.newAppSelected=false;this.newAppTimestamp=null;this.existingItems=[];this.app=null;this.showNewApp=false;this.showSelectApp=true;this.appType=null}render(){return e(s,null,e("slot",null),e("calcite-modal",{id:"modal",scale:"m",width:"m",ref:t=>this.modal=t},e("div",{slot:"header"},"Add an Application"),e("div",{id:"content",slot:"content"},this.renderContent())),this.renderNewButton())}openModal(){this.modal.open=true}componentWillLoad(){this.checkforExistingContent();setInterval((()=>{this.checkforExistingContent()}),5e3);setInterval((()=>{this.checkForNewContent()}),1e3)}async checkforExistingContent(){const t=(new N).match(this.username).in("owner").and().startGroup().match("StoryMap").in("type").or().match("Dashboard").in("type").or().match("Web Mapping Application").in("type").endGroup();await C({q:t,sortOrder:"desc",sortField:"created"}).then((t=>{this.existingItems=t.results}))}async checkForNewContent(){if(!this.newAppTimestamp){return}const t=this.newAppTimestamp;const e=new Date("2030-09-01");console.log("timestamp",{startDate:t,endDate:e});const s=(new N).from(t).to(e).in("created").and().match(this.getBuilder(this.appType).type).in("type").and().match(this.username).in("owner");let i=[];await C({q:s,sortOrder:"desc",sortField:"created"}).then((t=>{i=t.results}));if(i.length>0){this.app=i[0];this.newAppTimestamp=null}}renderGallery(){var t;const s=(t=this.existingItems)===null||t===void 0?void 0:t.map((t=>e("calcite-card",{class:"app"},e("span",{slot:"title"},t.title),e("span",{slot:"subtitle"},t.snippet),e("calcite-chip",{slot:"footer-start",value:t.type,appearance:"outline-fill",kind:"neutral",icon:"add-in"},t.type),e("calcite-button",{slot:"footer-end",href:this.getBuilder(t.type).view+t.id,target:"_new",appearance:"outline"},"Open App"),e("calcite-button",{slot:"footer-end",href:"javascript:window.alert('Add App')",appearance:"solid"},"Add App"))));console.log("items",{items:this.existingItems,cards:s});return e("div",null,s)}renderContent(){return e("calcite-shell",null,e("calcite-shell-panel",{collapsed:true,slot:"panel-start",position:"start",id:"shell-panel-start"},e("calcite-action-bar",{slot:"action-bar"},e("calcite-action",{active:this.showSelectApp,indicator:this.showSelectApp,onClick:()=>{this.showSelectApp=true;this.showNewApp=!this.showSelectApp},icon:"search",text:"Existing App"}),e("calcite-action",{active:this.showNewApp,indicator:this.showNewApp,onClick:()=>{this.showNewApp=true;this.showSelectApp=!this.showNewApp},text:"New App",icon:"add-in-new"}))),e("calcite-panel",{heading:this.showNewApp?`Create a New App`:`Search for Apps`},this.showNewApp?this.renderNewContent():this.renderGallery()))}renderNewContent(){if(!!this.app){return this.renderApp()}if(!this.newAppTimestamp){return this.renderNewOptions()}return this.renderLoading()}renderApp(){return e("calcite-card",{class:"app"},e("span",{slot:"title"},e("calcite-label",null,"App Title",e("calcite-input",{placeholder:"Enter App Title",value:this.app.title}))),e("span",{slot:"subtitle"},e("calcite-label",null,"App Summary",e("calcite-input",{placeholder:"Enter App Title",value:this.app.snippet}))),e("calcite-chip",{slot:"footer-start",value:this.app.type,appearance:"outline-fill",kind:"neutral",icon:"add-in"},this.app.type),e("calcite-button",{slot:"footer-end",href:"javascript:window.alert('Open Workspace')",appearance:"outline"},"Manage App"),e("calcite-button",{slot:"footer-end",href:this.getBuilder(this.appType).view+this.app.id,target:"_new"},"Add App"),e("strong",null,"Add App to the Catalog"),e("calcite-label",{layout:"inline"},e("calcite-checkbox",{checked:true}),"Add to Parks Content Group"),e("calcite-label",{layout:"inline"},e("calcite-checkbox",{checked:true}),"Add to Parks Collaboration Group"),e("calcite-button",{href:"#",appearance:"outline"},"Choose other groups"))}renderLoading(){return e("calcite-loader",{label:"Waiting for a new app to be created...",text:"Waiting for a new app to be created...",type:"indeterminate"})}renderNewButton(){return e("calcite-button",{appearance:"solid",color:"blue",scale:"l",onClick:()=>this.openModal()},"Add an App")}newAppOpen(t){this.newAppTimestamp=new Date;this.newAppSelected=true;this.appType=t;console.debug("newAppOpen",{type:t,new:this.getBuilder(this.appType)});window.open(this.getBuilder(this.appType).new,"_blank")}getBuilder(t){let e=this.builders.filter((e=>e.key===t));if(e.length===0){e=[this.defaultBuilder]}return e[0]}renderNewOptions(){return[e("div",{class:"new-options"},this.builders.map((t=>e("calcite-button",{appearance:"solid",color:"blue",onClick:()=>this.newAppOpen(t.key)},"New ",t.name)))),e("calcite-notice",{open:true,icon:"layers-reference"},e("div",{slot:"title"},"Create and then Embed"),e("div",{slot:"message"},'Choose a builder that will open in a new tab. When you save that App then it will be available here.",'),e("calcite-link",{slot:"link",title:"my action"},"Read more"))]}};D.style=E;export{D as hub_new_app};
//# sourceMappingURL=p-22e6b5c5.entry.js.map